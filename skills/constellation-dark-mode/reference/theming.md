# Theming

Theming is a feature of Constellation that allows you to customize the look and feel of your components. Constellation v10 offers two themes: `zillow` and `legacy-zillow`.

- **legacy-zillow**: Predominantly blue, uses Open Sans font, corporate in nature.
- **zillow**: The 2024 & 2025 visual identity refresh to Zillow's brand and product experiences.

The implementation adopts the out-of-the-box PandaCSS `themes` config property. Switching between themes requires updating the `data-panda-theme` attribute value.

## How to Apply a Theme

Two routes:
1. **Pregenerating** theme variants and including the CSS output
2. **Dynamic imports** using `styled-system/themes` entry point

### Pregenerating Themes

Specify themes in `staticCss.themes` to include them in CSS output:

```ts
// panda.config.ts
import { defineConfig } from '@pandacss/dev';
import { constellationPandaConfig } from '@zillow/constellation-config';

export default defineConfig(constellationPandaConfig({
  config: {
    staticCss: {
      themes: ['legacy-zillow'], // or 'zillow' or both
    },
  },
}));
```

### Dynamically Importing Themes

No need for `staticCss.themes`. Use `removeUnusedCssVariables` instead:

```ts
// panda.config.ts
import { defineConfig } from '@pandacss/dev';
import { constellationPandaConfig } from '@zillow/constellation-config';

export default defineConfig(constellationPandaConfig({
  removeUnusedCssVariables: true,
  config: {},
}));
```

### getTheme and injectTheme

Each theme has a corresponding JSON file generated by PandaCSS codegen:

```json
{
  "name": "zillow",
  "id": "panda-themes-zillow",
  "css": "[data-panda-theme=zillow] { ... }"
}
```

Apply a theme:

```ts
import { getTheme, injectTheme } from '@/styled-system/themes';

const theme = await getTheme('zillow');
injectTheme(document.documentElement, theme); // returns the injected style element
```

Dynamic theme selection:

```ts
const theme = await getTheme(THEME_NAME); // env variable or cookie
injectTheme(document.documentElement, theme);
```

Result:

```html
<html lang="en" data-panda-theme="zillow"></html>
```

### SSR Example with NextJS 14+

Supporting both `zillow` and `legacy-zillow` themes with `legacy-zillow` as default:

```tsx
// src/app/layout.tsx
import '@zillow/constellation-fonts/legacy-zillow-fonts.css';
import '@zillow/constellation-fonts/zillow-fonts.css';
import { cookies } from 'next/headers';
import { ThemeName, getTheme } from '@/styled-system/themes';
import './globals.css';

export default async function RootLayout({
  children,
}: Readonly<{ children: React.ReactNode }>) {
  const DEFAULT_THEME = 'legacy-zillow';
  const store = cookies();
  const themeName = (store.get('panda-theme')?.value as ThemeName) ?? DEFAULT_THEME;
  const theme = themeName && (await getTheme(themeName));

  return (
    <html lang="en" data-panda-theme={themeName}>
      <head>
        <link rel="preconnect" href="https://www.zillowstatic.com/" crossOrigin="anonymous" />
        {themeName === 'legacy-zillow' ? (
          <link rel="preload" href="https://www.zillowstatic.com/s3/constellation-website/public/shared/fonts/open-sans/LATEST/open-sans-variable.woff2" as="font" type="font/woff2" crossOrigin="anonymous" />
        ) : null}
        {themeName === 'zillow' ? (
          <>
            <link rel="preload" href="https://www.zillowstatic.com/s3/constellation-website/public/shared/fonts/object-sans/LATEST/object-sans-heavy.woff2" as="font" type="font/woff2" crossOrigin="anonymous" />
            <link rel="preload" href="https://www.zillowstatic.com/s3/constellation-website/public/shared/fonts/inter/LATEST/inter-variable.woff2" as="font" type="font/woff2" crossOrigin="anonymous" />
          </>
        ) : null}
        {themeName && (
          <style type="text/css" id={theme.id} dangerouslySetInnerHTML={{ __html: theme.css }} />
        )}
      </head>
      <body>{children}</body>
    </html>
  );
}
```

## Overriding a Theme

Update the config file `themes` property. The immediate child must be `extend`:

```ts
// panda.config.ts
import { defineConfig } from '@pandacss/dev';

export default defineConfig({
  theme: {
    extend: {},
  },
  themes: {
    extend: {
      'legacy-zillow': {
        // override values
      },
      'zillow': {
        // override values
      },
    },
  },
});
```
